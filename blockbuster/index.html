<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example 4 - Poem</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: black;
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            color: antiquewhite;
        }
        
        #myVideo {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
        }
       h1 {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2.5em;
        color: white;
        z-index: 10;
        }

        #poem p {
            position: absolute;
            top: 50%;
            right: 50%;
            transform: translate(-50%,-50%);
            padding: 1em;
            font-size:8em;
            background-color: black;
            transition: all 2.5s;
            aspect-ratio: 1/1;
        }
        

        
        .fa-expand {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 36px;
            color: white;
        }
        
        .fa-expand:hover {
            cursor: pointer;
        }
        
        .hidden {
            opacity: 0;
        }
        
        .showing {
            opacity: 1;
        }

        #danmu-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9;
        }

        .danmu-line {
        position: absolute;
        left: 100%;
        white-space: nowrap;
        font-size: 2em;
        color: white;
        animation: flyLeft 10s linear forwards;
        }

        @keyframes flyLeft {
        from {
            left: 100%;
        }
        to {
         left: -100%;
        }
        }

    </style>

</head>

<body>
    <h1>Running Competition</h1>
    <video id="myVideo" muted autoplay loop playsinline>

        <source src="media/Original.webm" type="video/webm">
        <source src="media/Original1.mp4" type="video/mp4">

        <p>Your browser doesn't support HTML5 video. Here is a <a href="media/Original1.mp4">link to the video</a>
            instead.</p>
    </video>
    <i class="fas fa-expand"></i>
    
    <!-- add lines of text here -->
    <section id="poem">
    <p id="line1" class="hidden">3</p>
     <p id="line2" class="hidden">2</p>
    <p id="line3" class="hidden">1</p>
    <p id="line4" class="hidden">Go</p>
    </section>

    <section id="danmu-container"></section>


    <script>
        (function() {
            'use strict';

            const myVideo = document.querySelector('#myVideo');
            const fs = document.querySelector('.fa-expand');

            // add the rest of the script here
            const line1 = document.querySelector('#line1');
            const line2 = document.querySelector('#line2');
            const line3 = document.querySelector('#line3');

            const poem = {
                start: [0, 1.5, 2.5,3.5],
                stop: [1.5, 2.5, 3.5,4.5],
                line: [line1, line2, line3,line4]
            }

            const intervalID = setInterval(checkTime, 1000);

            function checkTime() {
                console.log(parseInt(myVideo.currentTime));

                if (poem.start[0] < myVideo.currentTime && myVideo.currentTime < poem.stop[0]) {
                 poem.line[0].className = "showing";
                } else {
                    poem.line[0].className = "hidden";
                }
                if (poem.start[1] < myVideo.currentTime && myVideo.currentTime < poem.stop[1]) {
                    poem.line[1].className = "showing";
                } else {
                    poem.line[1].className = "hidden";
                 }
                if (poem.start[2] < myVideo.currentTime && myVideo.currentTime < poem.stop[2]) {
                    poem.line[2].className = "showing";
                } else {
                    poem.line[2].className = "hidden";
                }
                if (poem.start[3] < myVideo.currentTime && myVideo.currentTime < poem.stop[3]) {
                    poem.line[3].className = "showing";
                } else {
                    poem.line[3].className = "hidden";
                }
            }
            
            
            fs.addEventListener('click', function() {
                // The fullscreenElement attribute returns null if the element is in windowed mode
                if (!document.fullscreenElement) {
                    // document.documentElement returns the Element that is a direct child of the document, the <html> element
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();

                }
            });

         const danmuContainer = document.querySelector('#danmu-container');
        const danmuLines = [
            "Go Yorkie go!",
            "He's beating the human!",
            "4 pounds of speed!",
            "Run run run!",
            "Best race ever!",
            "Catch him if you can!",
            "He's just warming up!",
            "I'm crying this is so good",
            "Zoom zoom zoom",
            "Look at those tiny legs go!",
            "Give that dog a medal!",
            "Heâ€™s training for the Olympics!"];
        function createDanmu(text) {
            const el = document.createElement("div");
            el.className = "danmu-line";
            el.textContent = text;
            const trackHeight = 2; // in %
            const track = Math.floor(Math.random() * 20); // 0 to 9
            el.style.top = `${track * trackHeight + 5}%`;

            danmuContainer.appendChild(el);

            el.addEventListener("animationend", () => { el.remove();});
        }   
        setInterval(() => {
        for (let i = 0; i < 5; i++) { 
            const text = danmuLines[Math.floor(Math.random() * danmuLines.length)];
            createDanmu(text);
        }
    }, 800); 


        })();
    </script>
</body>

</html>